<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Weather Predictor</title>
    <!-- Load Tailwind CSS from CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Use the Inter font family */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Simple loading spinner */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <!-- Import Inter font from Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full overflow-hidden">
        
        <!-- Top Part: Weather Display -->
        <div class="p-8 md:p-12 bg-gradient-to-r from-blue-500 to-indigo-600 text-white">
            <h1 class="text-3xl font-bold mb-4">Today's Weather Outlook</h1>
            <div id="weather-display" class="bg-white bg-opacity-20 rounded-lg p-6 min-h-[100px] flex items-center justify-center">
                <!-- Weather content will be loaded here -->
                <div id="weather-loading" class="flex flex-col items-center">
                    <div class="loader"></div>
                    <p class="mt-2 text-sm font-medium">Fetching today's prediction...</p>
                </div>
                <div id="weather-content" class="hidden text-center">
                    <p id="weather-icon" class="text-6xl mb-2"></p>
                    <p id="weather-message" class="text-xl font-medium"></p>
                    <div id="recContainer"></div>

                </div>
                <p id="weather-error" class="hidden text-red-100 font-medium"></p>
            </div>
        </div>

        <!-- Bottom Part: Email Subscription -->
        <div class="p-8 md:p-12">
            <h2 class="text-2xl font-semibold text-gray-800 mb-3">Subscribe for Daily Updates</h2>
            <p class="text-gray-600 mb-6">Get the daily weather prediction sent straight to your inbox every morning.</p>
            
            <!-- Subscription Form -->
            <form id="subscribe-form" class="flex flex-col sm:flex-row gap-3">
                <label for="email" class="sr-only">Email address</label>
                <input 
                    type="email" 
                    id="email" 
                    placeholder="you@example.com" 
                    required 
                    class="flex-grow w-full px-4 py-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200"
                >
                <button 
                    type="submit" 
                    id="subscribe-button"
                    class="bg-blue-600 text-white font-semibold px-6 py-3 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-200"
                >
                    Subscribe
                </button>
            </form>
            
            <!-- Message area for success/error -->
            <div id="form-message" class="mt-4 text-sm font-medium"></div>
        </div>
    </div>

    <script>
        // Define the backend API base URL
        // Make sure your Node.js server is running on this port
        const API_URL = 'https://weather-website-07nt.onrender.com';

        // --- Weather Code Interpretation ---
        
        /**
         * Translates a WMO weather code into a human-readable message and an emoji icon.
         * @param {number} code - The WMO weather code.
         * @returns {{message: string, icon: string}} - An object with the message and icon.
         */
        function interpretWeatherCode(code) {
            switch (code) {
                case 0: return { message: 'Clear sky', icon: 'â˜€ï¸' };
                case 1: return { message: 'Mainly clear', icon: 'ðŸŒ¤ï¸' };
                case 2: return { message: 'Partly cloudy', icon: 'â›…' };
                case 3: return { message: 'Overcast', icon: 'â˜ï¸' };
                case 45: return { message: 'Fog', icon: 'ðŸŒ«ï¸' };
                case 48: return { message: 'Depositing rime fog', icon: 'ðŸŒ«ï¸' };
                case 51: return { message: 'Light drizzle', icon: 'ðŸŒ¦ï¸' };
                case 53: return { message: 'Moderate drizzle', icon: 'ðŸŒ¦ï¸' };
                case 55: return { message: 'Dense drizzle', icon: 'ðŸŒ§ï¸' };
                case 56: return { message: 'Light freezing drizzle', icon: 'ðŸŒ¨ï¸' };
                case 57: return { message: 'Dense freezing drizzle', icon: 'ðŸŒ¨ï¸' };
                case 61: return { message: 'Slight rain', icon: 'ðŸŒ¦ï¸' };
                case 63: return { message: 'Moderate rain', icon: 'ðŸŒ§ï¸' };
                case 65: return { message: 'Heavy rain', icon: 'ðŸŒ§ï¸' };
                case 66: return { message: 'Light freezing rain', icon: 'ðŸŒ¨ï¸' };
                case 67: return { message: 'Heavy freezing rain', icon: 'ðŸŒ¨ï¸' };
                case 71: return { message: 'Slight snow fall', icon: 'ðŸŒ¨ï¸' };
                case 73: return { message: 'Moderate snow fall', icon: 'â„ï¸' };
                case 75: return { message: 'Heavy snow fall', icon: 'â„ï¸' };
                case 77: return { message: 'Snow grains', icon: 'â„ï¸' };
                case 80: return { message: 'Slight rain showers', icon: 'ðŸŒ§ï¸' };
                case 81: return { message: 'Moderate rain showers', icon: 'ðŸŒ§ï¸' };
                case 82: return { message: 'Violent rain showers', icon: 'â›ˆï¸' };
                case 85: return { message: 'Slight snow showers', icon: 'ðŸŒ¨ï¸' };
                case 86: return { message: 'Heavy snow showers', icon: 'â„ï¸' };
                case 95: return { message: 'Thunderstorm', icon: 'â›ˆï¸' };
                case 96: return { message: 'Thunderstorm with slight hail', icon: 'â›ˆï¸' };
                case 99: return { message: 'Thunderstorm with heavy hail', icon: 'â›ˆï¸' };
                default: return { message: `Unknown weather code: ${code}`, icon: 'â“' };
            }
        }
        const weatherRecommendations = {
    0: [
        "Wear sunglasses to protect your eyes.",
        "Apply sunscreen if you're heading out.",
        "Carry a water bottle to stay hydrated.",
        "Wear light breathable clothing.",
        "Perfect day for outdoor activities.",
        "Take breaks in the shade to avoid overheating.",
        "Avoid wearing dark clothes that trap heat.",
        "Great weather for outdoor photography.",
        "Keep a hat or cap to reduce sun exposure.",
        "Plan longer walks during early morning or late afternoon."
    ],
    1: [
        "Sunglasses recommended for bright moments.",
        "Carry a light jacket just in case.",
        "Great time for a short outdoor walk.",
        "Stay hydrated throughout the day.",
        "Use sunscreen if you'll be outside long.",
        "Enjoy the sunshine but avoid peak UV hours.",
        "Keep a hat with you for comfort.",
        "Good day for cycling outdoors.",
        "Mild weather â€” perfect for casual outings.",
        "Keep an eye on sudden temperature changes."
    ],
    2: [
        "Bring a light jacket as weather may shift.",
        "Good for outdoor activities with mild sunlight.",
        "Keep sunglasses handy.",
        "Stay hydrated during long walks.",
        "Check hourly forecast if outside long.",
        "Great conditions for running or jogging.",
        "UV may still be moderate â€” apply sunscreen.",
        "Clouds may increase later â€” plan ahead.",
        "Comfortable day for travel.",
        "Watch for brief windy spells."
    ],
    3: [
        "Carry a light jacket for cooler temperatures.",
        "Great day for photography with soft lighting.",
        "Consider carrying a small umbrella.",
        "Wear layered clothing.",
        "Check for possible rain later.",
        "Ideal weather for long walks.",
        "Avoid thin clothing â€” it may feel colder.",
        "Plan indoor options too just in case.",
        "Roads may be damp â€” walk carefully.",
        "Keep your phone charged in case the weather changes."
    ],
    45: [
        "Drive slower and keep headlights low beam.",
        "Wear reflective clothing when walking.",
        "Allow extra travel time.",
        "Avoid biking in poor visibility.",
        "Keep your phone charged for safety.",
        "Use fog lights if your vehicle has them.",
        "Avoid running or cycling near roads.",
        "Stay in well-lit areas when walking.",
        "Keep windows slightly open to prevent fogging.",
        "Avoid unnecessary travel if visibility is extremely low."
    ],
    48: [
        "Drive slower and keep headlights low beam.",
        "Wear reflective clothing when walking.",
        "Allow extra travel time.",
        "Avoid biking in poor visibility.",
        "Keep your phone charged for safety.",
        "Use fog lights if available.",
        "Avoid walking near busy roads.",
        "Visibility may worsen quickly â€” stay alert.",
        "Keep car windows clear from inside moisture.",
        "Stay indoors when possible."
    ],
    51: [
        "Carry a waterproof jacket.",
        "Avoid wearing slippery shoes.",
        "Protect electronics from moisture.",
        "Drive slowly â€” roads may be slick.",
        "Use an umbrella for short walks.",
        "Avoid long outdoor activities.",
        "Wear waterproof or quick-dry clothing.",
        "Be cautious on painted road lines.",
        "Drizzle can turn heavy â€” stay aware.",
        "Choose water-resistant bags if commuting."
    ],
    53: [
        "Carry a waterproof jacket.",
        "Avoid wearing slippery shoes.",
        "Protect electronics from moisture.",
        "Drive slowly â€” roads may be slick.",
        "Use an umbrella for short walks.",
        "Keep your hood or cap ready.",
        "Sidewalks may be wet â€” walk carefully.",
        "Moisture may fog glasses â€” wipe lenses often.",
        "Expect brief increases in drizzle intensity.",
        "Carry a microfiber cloth for glasses or screens."
    ],
    55: [
        "Carry a waterproof jacket.",
        "Avoid wearing slippery shoes.",
        "Protect electronics from moisture.",
        "Drive slowly â€” roads may be slick.",
        "Use an umbrella for short walks.",
        "Avoid long-distance outdoor plans.",
        "Wear water-resistant pants.",
        "Puddles may form â€” walk around them.",
        "Check weather updates frequently.",
        "Bring extra socks if commuting long distances."
    ],
    56: [
        "Wear proper winter shoes â€” freezing drizzle is slippery.",
        "Use gloves to stay warm.",
        "Drive carefully â€” black ice possible.",
        "Carry a warm jacket.",
        "Avoid long-distance travel.",
        "Walk slowly to avoid slipping.",
        "Keep salt or traction aids in your car.",
        "Wear a beanie or head warmer.",
        "Avoid stairs or steep slopes outdoors.",
        "Plan indoor activities instead."
    ],
    57: [
        "Wear proper winter shoes â€” freezing drizzle is slippery.",
        "Use gloves to stay warm.",
        "Drive carefully â€” black ice possible.",
        "Carry a warm jacket.",
        "Avoid long-distance travel.",
        "Move cautiously on sidewalks.",
        "Protect your phone from the cold.",
        "Wear thermal socks.",
        "Avoid icy roads when possible.",
        "Stay indoors unless necessary."
    ],
    61: [
        "Carry an umbrella or raincoat.",
        "Wear waterproof shoes.",
        "Beware of slippery sidewalks.",
        "Put electronics in waterproof bags.",
        "Drive slower than usual.",
        "Avoid staying in wet clothes too long.",
        "Plan extra commute time.",
        "Wear quick-dry layers.",
        "Expect visibility to reduce briefly.",
        "Stay away from roadsides during splashes."
    ],
    63: [
        "Carry an umbrella or raincoat.",
        "Wear waterproof shoes.",
        "Beware of slippery sidewalks.",
        "Put electronics in waterproof bags.",
        "Drive slower than usual.",
        "Rain may intensify â€” stay prepared.",
        "Use waterproof covers for backpacks.",
        "Avoid cycling if possible.",
        "Hydrate despite the cool weather.",
        "Watch out for puddles and mud."
    ],
    65: [
        "Carry an umbrella or raincoat.",
        "Avoid unnecessary outdoor activities.",
        "Wear waterproof shoes.",
        "Drive carefully â€” heavy rain reduces visibility.",
        "Keep electronic items protected.",
        "Expect delays in public transport.",
        "Avoid areas prone to flooding.",
        "Secure loose items if itâ€™s windy.",
        "Avoid walking under trees in strong rain.",
        "Wait for rain to ease before heading out."
    ],
    66: [
        "Avoid unnecessary travel â€” freezing rain is dangerous.",
        "Wear shoes with good grip.",
        "Drive extremely cautiously.",
        "Dress warmly with layers.",
        "Beware of black ice.",
        "Stay indoors whenever possible.",
        "Check road warnings regularly.",
        "Protect exposed skin from cold.",
        "Keep emergency supplies ready.",
        "Walk slowly and avoid slopes."
    ],
    67: [
        "Avoid unnecessary travel â€” freezing rain is dangerous.",
        "Wear shoes with good grip.",
        "Drive extremely cautiously.",
        "Dress warmly with layers.",
        "Beware of black ice.",
        "Keep your phone fully charged.",
        "Stay indoors unless absolutely necessary.",
        "Avoid parking under trees.",
        "Watch for falling ice from roofs.",
        "Monitor weather alerts often."
    ],
    71: [
        "Wear warm layers and gloves.",
        "Walk carefully â€” snow may hide ice.",
        "Give extra time for commuting.",
        "Wear snow-friendly boots.",
        "Check for school or transit delays.",
        "Keep hands protected with warm gloves.",
        "Avoid long outdoor stays.",
        "Salt may be on sidewalks â€” walk carefully.",
        "Visibility may reduce slightly â€” be alert.",
        "Carry tissues for cold air."
    ],
    73: [
        "Wear warm layers and gloves.",
        "Walk carefully â€” snow may hide ice.",
        "Give extra time for commuting.",
        "Wear snow-friendly boots.",
        "Check for school or transit delays.",
        "Avoid slippery staircases.",
        "Winter air may dry skin â€” use moisturizer.",
        "Keep your phone battery warm.",
        "Dress with thermal layers.",
        "Expect moderate accumulation on surfaces."
    ],
    75: [
        "Avoid unnecessary travel â€” heavy snow.",
        "Wear thermal layers.",
        "Carry emergency supplies if driving.",
        "Keep phones fully charged.",
        "Expect delays in transportation.",
        "Stay updated with weather alerts.",
        "Roads may be blocked â€” check conditions.",
        "Wear insulated boots.",
        "Visibility may be very low â€” be cautious.",
        "Stay indoors unless essential."
    ],
    77: [
        "Wear warm layers.",
        "Walk carefully on icy surfaces.",
        "Avoid long-distance travel.",
        "Wear good-grip footwear.",
        "Check transport conditions.",
        "Snow grains may reduce visibility.",
        "Bring a flashlight if out late.",
        "Use waterproof gloves.",
        "Sidewalks may be uneven â€” walk slowly.",
        "Avoid driving on untreated roads."
    ],
    80: [
        "Carry an umbrella.",
        "Wear quick-dry clothes.",
        "Avoid cycling in rain.",
        "Protect electronics.",
        "Check for delays.",
        "Expect sudden strong showers.",
        "Wear water-resistant shoes.",
        "Be cautious of slippery painted roads.",
        "Secure loose items if windy.",
        "Keep spare socks if commuting."
    ],
    81: [
        "Carry an umbrella.",
        "Wear quick-dry clothes.",
        "Avoid cycling in rain.",
        "Protect electronics.",
        "Check for delays.",
        "Rain may intensify quickly.",
        "Sidewalks can get slick â€” walk carefully.",
        "Avoid standing under trees.",
        "Wear waterproof accessories.",
        "Plan indoor alternatives."
    ],
    82: [
        "Stay indoors if possible due to violent showers.",
        "Avoid travel in heavy rainfall.",
        "Watch for flooding alerts.",
        "Do not bicycle in heavy rain.",
        "Unplug electronics during severe rain.",
        "Avoid low-lying areas.",
        "Secure outdoor belongings.",
        "Stay away from large trees.",
        "Delay outdoor activities.",
        "Keep emergency alerts turned on."
    ],
    85: [
        "Wear warm clothing.",
        "Watch for ice patches.",
        "Keep gloves and warm socks on.",
        "Avoid unnecessary travel.",
        "Check road conditions before driving.",
        "Visibility may drop during showers.",
        "Use insulated boots.",
        "Keep emergency items ready.",
        "Clear snow from shoes indoors.",
        "Walk carefully on sidewalks."
    ],
    86: [
        "Avoid travel â€” heavy snow showers.",
        "Wear insulated clothing.",
        "Keep emergency supplies.",
        "Watch for road closures.",
        "Walk carefully on slippery surfaces.",
        "Visibility may be very low.",
        "Wear layered winter gear.",
        "Avoid driving unless required.",
        "Keep your phone charged.",
        "Snow may accumulate quickly â€” stay cautious."
    ],
    95: [
        "Stay indoors during thunderstorms.",
        "Avoid open fields and tall structures.",
        "Unplug sensitive electronics.",
        "Delay outdoor activities.",
        "Do not stand near windows.",
        "Avoid using wired electronics.",
        "Stay away from water (pools/showers).",
        "Secure outdoor items.",
        "Listen for emergency alerts.",
        "Avoid driving in lightning-heavy areas."
    ],
    96: [
        "Stay away from windows during hail.",
        "Avoid travel â€” hail can damage cars.",
        "Seek indoor shelter.",
        "Unplug electronics.",
        "Monitor weather alerts.",
        "Protect pets or bring them indoors.",
        "Stay clear of glass surfaces.",
        "Avoid parking under trees.",
        "Keep emergency numbers handy.",
        "Wait for hail to stop before going outside."
    ],
    99: [
        "Stay away from windows during severe hail.",
        "Seek immediate indoor shelter.",
        "Avoid driving â€” hail can break windshields.",
        "Unplug electronics.",
        "Monitor emergency alerts.",
        "Move to inner rooms for safety.",
        "Protect your head if caught outside.",
        "Stay indoors until storm passes.",
        "Check for damage cautiously after storm.",
        "Avoid all outdoor activity during hail."
    ]
};



        // --- DOM Elements ---
        const weatherLoading = document.getElementById('weather-loading');
        const weatherContent = document.getElementById('weather-content');
        const weatherError = document.getElementById('weather-error');
        const weatherIcon = document.getElementById('weather-icon');
        const weatherMessage = document.getElementById('weather-message');
        const subscribeForm = document.getElementById('subscribe-form');
        const emailInput = document.getElementById('email');
        const subscribeButton = document.getElementById('subscribe-button');
        const formMessage = document.getElementById('form-message');

        // --- Fetch Weather on Page Load ---
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const response = await fetch(`${API_URL}/weather`);
                const data = await response.json();

                if (!response.ok || !data.weatherCode) throw new Error();

                const code = parseInt(data.weatherCode);
                const { message, icon } = interpretWeatherCode(code);

                // Display weather
                weatherIcon.textContent = icon;
                weatherMessage.textContent = message;

                // Show 2 random recommendations
                const recs = weatherRecommendations[code] || [];
                const two = recs.sort(() => 0.5 - Math.random()).slice(0, 5);

                recContainer.innerHTML = `
    <div class="mt-4 bg-white bg-opacity-10 p-4 rounded-lg text-left">
        <button 
            id="recToggle"
            class="flex items-center justify-between w-full text-left text-lg font-semibold mb-2 hover:opacity-80 transition"
        >
            Recommendations
            <span id="recArrow" class="transition-transform text-xl">â–¼</span>
        </button>

        <div id="recContent" class="hidden mt-2">
            <ul class="list-disc list-inside text-sm">
                ${two.map(r => `<li>${r}</li>`).join('')}
            </ul>
        </div>
    </div>
`;
document.getElementById("recToggle").addEventListener("click", () => {
    const content = document.getElementById("recContent");
    const arrow = document.getElementById("recArrow");

    content.classList.toggle("hidden");

    // Flip arrow direction
    if (content.classList.contains("hidden")) {
        arrow.style.transform = "rotate(0deg)";
    } else {
        arrow.style.transform = "rotate(180deg)";
    }
});



                weatherLoading.classList.add('hidden');
                weatherContent.classList.remove('hidden');

            } catch (error) {
                weatherError.textContent = "Could not load weather. Please try again later.";
                weatherLoading.classList.add('hidden');
                weatherError.classList.remove('hidden');
            }
        });

        // --- Handle Subscription Form ---
        subscribeForm.addEventListener('submit', async (e) => {
            e.preventDefault(); // Prevent default form submission
            
            const email = emailInput.value;
            if (!email) return;

            // Disable form and show loading state
            subscribeButton.disabled = true;
            subscribeButton.textContent = 'Subscribing...';
            formMessage.textContent = '';
            formMessage.className = 'mt-4 text-sm font-medium';

            try {
                const response = await fetch(`${API_URL}/subscribe`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email: email }),
                });

                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.message || 'Subscription failed.');
                }

                // Success
                formMessage.textContent = result.message || 'Success! You are now subscribed.';
                formMessage.classList.add('text-green-600');
                emailInput.value = ''; // Clear input field

            } catch (error) {
                console.error('Subscription error:', error);
                formMessage.textContent = error.message || 'An error occurred. Please try again.';
                formMessage.classList.add('text-red-600');
            } finally {
                // Re-enable form
                subscribeButton.disabled = false;
                subscribeButton.textContent = 'Subscribe';
            }
        });
    </script>
</body>
</html>
